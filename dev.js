!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).bundle={},t.Quill)}(this,(function(t,e){"use strict";const i="mermaid-mode-change",o=()=>Math.random().toString(36).slice(2),s=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"];function r(t,e){t.addEventListener("scroll",e),this.scrollHandler.push([t,e])}function l(){for(let t=0;t<this.scrollHandler.length;t++){const[e,i]=this.scrollHandler[t];e.removeEventListener("scroll",i)}this.scrollHandler=[]}const a=e.import("blots/block/embed");async function d(t,e,i){let o=null;try{await window.mermaid.parse(e)&&(o=await window.mermaid.render(`chart-${t}`,e,i)),o&&(i.innerHTML=o.svg)}catch(t){console.error(t),i.innerHTML=t.message}return o}window.mermaid.initialize({startOnLoad:!1});class n extends a{static tagName="div";static blotName="mermaid-chart";static className="ql-mermaid-chart";static create(t){const e=super.create();e.setAttribute("contenteditable","false"),e.dataset.chart=t;const i=o();e.dataset.id=i;const s=document.createElement("div");return s.classList.add("chart"),e.appendChild(s),new Promise((async e=>{await d(i,t,s),e()})),e}static value(t){return t.dataset.chart||""}mode="chart";editor;getChart(){return this.domNode.querySelector(".chart")}createEditor(){if(this.editor)return;this.editor=document.createElement("textarea"),this.editor.classList.add("editor");const t=n.value(this.domNode);this.editor.value=t,this.editor.addEventListener("keydown",(t=>{t.stopPropagation(),"Tab"===t.code&&t.preventDefault()})),this.editor.addEventListener("input",(()=>{this.editor&&(c(this.editor),this.editor.blur(),setTimeout((()=>{this.editor.focus()}),0))})),this.domNode.appendChild(this.editor),c(this.editor)}async removeEditor(){if(!this.editor)return;const t=this.editor.value,e=this.getChart(),i=o(),s=await d(i,t,e);this.domNode.dataset.chart=t,s&&(this.domNode.dataset.id=i),this.editor.remove(),this.editor=void 0}async switchMode(){if("chart"===this.mode){this.createEditor();this.getChart().style.display="none",this.mode="edit"}else{this.getChart().style.display="block",await this.removeEditor(),this.mode="chart"}this.scroll.emitter.emit(i,this.mode)}}function c(t){const e=(t=>{const e=getComputedStyle(t),i=e.getPropertyValue("box-sizing"),o=Number.parseFloat(e.getPropertyValue("padding-bottom"))+Number.parseFloat(e.getPropertyValue("padding-top")),r=Number.parseFloat(e.getPropertyValue("border-bottom-width"))+Number.parseFloat(e.getPropertyValue("border-top-width")),l=s.map((t=>`${t}:${e.getPropertyValue(t)}`)).join(";"),a=document.createElement("textarea");document.body.appendChild(a),a.setAttribute("style",`${l};\n    height:0 !important;\n    visibility:hidden !important;\n    overflow:hidden !important;\n    position:absolute !important;\n    z-index:-1000 !important;\n    top:0 !important;\n    right:0 !important;\n`),a.value=t.value||t.placeholder||"";let d=a.scrollHeight;"border-box"===i?d+=r:"content-box"===i&&(d-=o),a.value="";let n=1*(a.scrollHeight-o);return"border-box"===i&&(n=n+o+r),d=Math.max(n,d),a.parentNode?.removeChild(a),{minHeight:`${n}px`,height:`${d}px`}})(t);Object.assign(t.style,e)}class h{quill;mermaidBlot;options;scrollHandler=[];toolbox;selector;#t=!1;resizeOb;constructor(t,e,i){this.quill=t,this.mermaidBlot=e,this.options=this.resolveOptions(i),this.toolbox=this.quill.addContainer("ql-toolbox"),this.createSelector()}resolveOptions(t){return Object.assign({onDestroy:()=>{}},t)}addContainer(t){if(!this.toolbox)return;const e=document.createElement("div");for(const i of t.split(" "))e.classList.add(i);return this.toolbox.appendChild(e),e}updateSelector(){if(!this.selector)return;const t=this.mermaidBlot.domNode.getBoundingClientRect(),{x:e,y:i}=function(t,e){const i=e.getBoundingClientRect();return{x:t.x-i.x-e.scrollLeft,y:t.y-i.y-e.scrollTop,x1:t.x-i.x-e.scrollLeft+t.width,y1:t.y-i.y-e.scrollTop+t.height,width:t.width,height:t.height}}(t,this.quill.root),{scrollTop:o,scrollLeft:s}=this.quill.root;Object.assign(this.selector.style,{left:`${e+s}px`,top:`${i+o}px`,width:`${t.width}px`,height:`${t.height}px`}),l.call(this),r.call(this,this.quill.root,(()=>{Object.assign(this.selector.style,{left:e+2*s-this.quill.root.scrollLeft+"px",top:i+2*o-this.quill.root.scrollTop+"px"})}))}createSelector(){if(this.selector=this.addContainer("ql-mermaid-select"),!this.selector)return;this.updateSelector(),this.resizeOb=new ResizeObserver((()=>{this.updateSelector()})),this.resizeOb.observe(this.mermaidBlot.domNode);const t=m({iconStr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h8.925l-2 2H5v14h14v-6.95l2-2V19q0 .825-.587 1.413T19 21zm4-6v-4.25l9.175-9.175q.3-.3.675-.45t.75-.15q.4 0 .763.15t.662.45L22.425 3q.275.3.425.663T23 4.4t-.137.738t-.438.662L13.25 15zM21.025 4.4l-1.4-1.4zM11 13h1.4l5.8-5.8l-.7-.7l-.725-.7L11 11.575zm6.5-6.5l-.725-.7zl.7.7z"/></svg>',classList:["ql-mermaid-select-edit"],click:()=>{this.mermaidBlot.switchMode(),this.#t=!0,this.destroy()}}),e=m({iconStr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="m12 13.4l-4.9 4.9q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7l4.9-4.9l-4.9-4.9q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l4.9 4.9l4.9-4.9q.275-.275.7-.275t.7.275t.275.7t-.275.7L13.4 12l4.9 4.9q.275.275.275.7t-.275.7t-.7.275t-.7-.275z"/></svg>',classList:["ql-mermaid-select-close"],click:()=>{this.mermaidBlot.remove(),this.#t=!0,this.destroy()}});this.quill.on(i,(t=>{this.selector&&this.selector.classList.add(t)})),this.selector?.classList.add(this.mermaidBlot.mode),this.selector.appendChild(e),this.selector.appendChild(t)}destroy(){this.quill.off(i),l.call(this),this.resizeOb&&this.resizeOb.disconnect(),this.toolbox&&(this.toolbox.remove(),this.toolbox=void 0),this.#t&&(this.#t=!1,this.options.onDestroy())}}function m(t){const{iconStr:e,classList:i,click:o}=t,s=document.createElement("span");s.classList.add("ql-mermaid-select-btn",...i);const r=document.createElement("i");return r.classList.add("ql-mermaid-icon"),r.innerHTML=e,s.appendChild(r),s.addEventListener("click",o),s}const u=e.import("ui/icons");t.QuillMermaid=class{quill;static register(){u[n.blotName]='<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 490.16 490.16"><defs><mask id="Mask"><rect x="0" y="0" width="490.16" height="490.16" fill="white"></rect><path fill="black" d="M407.48,111.18A165.2,165.2,0,0,0,245.08,220,165.2,165.2,0,0,0,82.68,111.18a165.5,165.5,0,0,0,72.06,143.64,88.81,88.81,0,0,1,38.53,73.45v50.86H296.9V328.27a88.8,88.8,0,0,1,38.52-73.45,165.41,165.41,0,0,0,72.06-143.64Z"></path><path fill="black" d="M160.63,328.27a56.09,56.09,0,0,0-24.27-46.49,198.74,198.74,0,0,1-28.54-23.66A196.87,196.87,0,0,1,82.53,227V379.13h78.1Z"></path><path fill="black" d="M329.53,328.27a56.09,56.09,0,0,1,24.27-46.49,198.74,198.74,0,0,0,28.54-23.66A196.87,196.87,0,0,0,407.63,227V379.13h-78.1Z"></path></mask><style>.cls-1{fill:#76767B;}.cls-1:hover{fill:#FF3570}</style></defs><rect class="cls-1" width="490.16" height="490.16" rx="84.61" mask="url(#Mask)"></rect></svg>',e.register({[`formats/${n.blotName}`]:n},!0)}mermaidBlot;mermaidSelector;constructor(t){this.quill=t;const i=this.quill.getModule("toolbar");i&&i.addHandler(n.blotName,(()=>{const t=this.quill.getSelection(!0);this.quill.insertEmbed(t.index,n.blotName,"")})),this.quill.root.addEventListener("click",(t=>{if(!this.quill.scroll.isEnabled())return;const i=t.composedPath();if(!i||i.length<=0)return;const o=i.find((t=>e.find(t)instanceof n));if(o){const t=e.find(o);if(this.mermaidBlot===t)return;this.updateMermaidSelector(t)}else this.destroyMermaidSelector()}),!1),this.quill.on(e.events.TEXT_CHANGE,(()=>{this.destroyMermaidSelector()}))}updateMermaidSelector(t){this.mermaidSelector&&this.destroyMermaidSelector(),t&&(this.mermaidBlot=t,this.mermaidSelector=new h(this.quill,this.mermaidBlot,{onDestroy:()=>this.destroyMermaidSelector()}))}destroyMermaidSelector(){this.mermaidSelector&&(this.mermaidSelector.destroy(),this.mermaidBlot=void 0,this.mermaidSelector=void 0)}}}));
//# sourceMappingURL=dev.js.map
