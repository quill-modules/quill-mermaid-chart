!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).bundle={},t.Quill)}(this,(function(t,e){"use strict";var i='<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>';const s=(t,e,i,s)=>{t.addEventListener("transitionend",i,s),setTimeout((()=>{i()}),e)},n=Array.isArray,o=t=>{const{appendTo:e=document.body,title:o,description:l,content:r,confirm:a=!0,cancel:d=!0,clickMaskClose:c=!0,onClose:h,onShow:m,onConfirm:u}=t||{},p=document.createElement("div");p.classList.add("qmc-mask");const g=document.createElement("div");g.classList.add("qmc-dialog");let v="",f="";const x=()=>{const t=g.getBoundingClientRect();t.width>window.innerWidth?(v||(v=g.style.maxWidth),g.style.maxWidth=`${window.innerWidth}px`):v&&(g.style.maxWidth=v,v=""),t.height>window.innerHeight?(f||(f=g.style.maxHeight),g.style.maxHeight=`${window.innerHeight}px`):f&&(g.style.maxHeight=f,f="")},w=()=>{for(const t of[p,g])t.classList.remove("open"),t.classList.add("close"),s(t,300,(()=>{t.remove()}),{once:!0});document.removeEventListener("keydown",C),window.removeEventListener("resize",x),h&&h()};if(o||l){const t=document.createElement("div");if(t.classList.add("qmc-dialog-header"),o){const e=document.createElement("h3");e.classList.add("qmc-dialog-title"),e.textContent=o,t.appendChild(e)}if(l){const e=document.createElement("p");e.classList.add("qmc-dialog-description"),e.textContent=l,t.appendChild(e)}g.appendChild(t)}if(r){const t=document.createElement("div");t.classList.add("qmc-dialog-content");for(const e of n(y=r)?y:[y])t.appendChild(e);g.appendChild(t)}var y;if(a||d){const t=document.createElement("div");if(t.classList.add("qmc-dialog-footer"),d){const e=document.createElement("button");e.classList.add("qmc-dialog-btn","qmc-dialog-cancel"),e.textContent="Cancel",e.addEventListener("click",(()=>w())),t.appendChild(e)}if(a){const e=document.createElement("button");e.classList.add("qmc-dialog-btn","qmc-dialog-confirm"),e.textContent="Confirm",e.addEventListener("click",(async()=>{u&&await u(),w()})),t.appendChild(e)}g.appendChild(t)}const b=document.createElement("button");b.classList.add("qmc-dialog-btn","qmc-dialog-close"),b.innerHTML=i,g.appendChild(b);const C=t=>{"Escape"===t.code&&w()};return c&&p.addEventListener("click",w),b.addEventListener("click",w),document.addEventListener("keydown",C),g.addEventListener("click",(t=>t.stopPropagation())),g.addEventListener("keydown",(t=>t.stopPropagation())),e.appendChild(p),e.appendChild(g),setTimeout((()=>{p.classList.add("open"),g.classList.add("open"),window.addEventListener("resize",x),s(g,300,(()=>{m&&m()}),{once:!0})})),{mask:p,dialog:g,close:w}},l="mermaid-mode-change",r=Symbol("mermaid-data"),a={Flowchart:"graph LR\n  A[Start] --\x3e B{Is it?};\n  B --\x3e|Yes| C[OK];\n  C --\x3e D[Rethink];\n  D --\x3e B;\n  B ----\x3e|No| E[End];","Sequence Diagrams":"sequenceDiagram\n    Alice->>John: Hello John, how are you?\n    John--\x3e>Alice: Great!\n    Alice-)John: See you later!","Class Diagram":'---\ntitle: Animal example\n---\nclassDiagram\n    note "From Duck till Zebra"\n    Animal <|-- Duck\n    note for Duck "can fly\ncan swim\ncan dive\ncan help in debugging"\n    Animal <|-- Fish\n    Animal <|-- Zebra\n    Animal : +int age\n    Animal : +String gender\n    Animal: +isMammal()\n    Animal: +mate()\n    class Duck{\n        +String beakColor\n        +swim()\n        +quack()\n    }\n    class Fish{\n        -int sizeInFeet\n        -canEat()\n    }\n    class Zebra{\n        +bool is_wild\n        +run()\n    }',"State Diagrem":"---\ntitle: Simple sample\n---\nstateDiagram-v2\n    [*] --\x3e Still\n    Still --\x3e [*]\n\n    Still --\x3e Moving\n    Moving --\x3e Still\n    Moving --\x3e Crash\n    Crash --\x3e [*]","Pie Chart":'pie title Pets adopted by volunteers\n    "Dogs" : 386\n    "Cats" : 85\n    "Rats" : 15',Timeline:"timeline\n    title History of Social Media Platform\n    2002 : LinkedIn\n    2004 : Facebook\n         : Google\n    2005 : Youtube\n    2006 : Twitter"},d=Symbol("histroy-stack"),c=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey",h="function"==typeof Buffer;"function"==typeof TextDecoder&&new TextDecoder;const m="function"==typeof TextEncoder?new TextEncoder:void 0,u=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");(t=>{let e={};t.forEach(((t,i)=>e[t]=i))})(u);const p=String.fromCharCode.bind(String);"function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array);const g="function"==typeof btoa?t=>btoa(t):h?t=>Buffer.from(t,"binary").toString("base64"):t=>{let e,i,s,n,o="";const l=t.length%3;for(let l=0;l<t.length;){if((i=t.charCodeAt(l++))>255||(s=t.charCodeAt(l++))>255||(n=t.charCodeAt(l++))>255)throw new TypeError("invalid character found");e=i<<16|s<<8|n,o+=u[e>>18&63]+u[e>>12&63]+u[e>>6&63]+u[63&e]}return l?o.slice(0,l-3)+"===".substring(l):o},v=h?t=>Buffer.from(t).toString("base64"):t=>{let e=[];for(let i=0,s=t.length;i<s;i+=4096)e.push(p.apply(null,t.subarray(i,i+4096)));return g(e.join(""))},f=t=>{if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?p(192|e>>>6)+p(128|63&e):p(224|e>>>12&15)+p(128|e>>>6&63)+p(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return p(240|e>>>18&7)+p(128|e>>>12&63)+p(128|e>>>6&63)+p(128|63&e)},x=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,w=h?t=>Buffer.from(t,"utf8").toString("base64"):m?t=>v(m.encode(t)):t=>g(t.replace(x,f)),y=(t,e,i)=>{t&&(t=t.cloneNode(!0)),i&&t.setAttribute("height",`${i}px`),e&&t.setAttribute("width",`${e}px`);return((t,e=!1)=>e?(t=>t.replace(/=/g,"").replace(/[+\/]/g,(t=>"+"==t?"-":"_")))(w(t)):w(t))(`${t.outerHTML.replaceAll("<br>","<br/>").replaceAll(/<img([^>]*)>/g,((t,e)=>`<img ${e} />`))}`)};function b(t,e,i,s,n){const{close:o}=(t=>{const e=document.createElement("div");e.classList.add("qmc-loading-mask");const i=document.createElement("div");return i.classList.add("qmc-loading-icon"),e.appendChild(i),t.appendChild(e),{close:()=>{e.remove()}}})(t);new Promise((async t=>{await async function(t,e,i,{config:s}={}){let n=null;try{window.mermaid.initialize(Object.assign({},{startOnLoad:!1,flowchart:{useMaxWidth:!1},sequence:{useMaxWidth:!1},gantt:{useMaxWidth:!1},journey:{useMaxWidth:!1},timeline:{useMaxWidth:!1},class:{useMaxWidth:!1},state:{useMaxWidth:!1},er:{useMaxWidth:!1},pie:{useMaxWidth:!1},quadrantChart:{useMaxWidth:!1},xyChart:{useMaxWidth:!1},requirement:{useMaxWidth:!1},architecture:{useMaxWidth:!1},mindmap:{useMaxWidth:!1},kanban:{useMaxWidth:!1},gitGraph:{useMaxWidth:!1},c4:{useMaxWidth:!1},sankey:{useMaxWidth:!1},packet:{useMaxWidth:!1},block:{useMaxWidth:!1}},s));if(await window.mermaid.parse(e)&&(n=await window.mermaid.render(`chart-${t}`,e,i)),n){const t=(t=>{const e=(new DOMParser).parseFromString(t,"text/html"),i=document.createElement("canvas"),s=e.querySelector("svg");if(!s)throw new Error("svg not found");let n=Number(s.getAttribute("width")),o=Number(s.getAttribute("height"));Number.isNaN(n)&&(n=0),Number.isNaN(o)&&(o=0),i.width=n,i.height=o;const l=i.getContext("2d");if(!l)throw new Error("context not found");return l.fillStyle=`hsl(${window.getComputedStyle(document.body).getPropertyValue("--b1")})`,l.fillRect(0,0,i.width,i.height),`data:image/svg+xml;base64,${y(s,i.width,i.height)}`})(n.svg),e=new Image;e.src=t,i.innerHTML="",i.appendChild(e)}}catch(t){console.error(t),i.innerHTML=t.message}return n}(e,i,s,n),o(),t()}))}function C(t,e){t.addEventListener("scroll",e),this.scrollHandler.push([t,e])}function E(){for(let t=0;t<this.scrollHandler.length;t++){const[e,i]=this.scrollHandler[t];e.removeEventListener("scroll",i)}this.scrollHandler=[]}const L=e.import("blots/block/embed");class q extends L{static tagName="div";static blotName="mermaid-chart";static className="ql-mermaid-chart";static create(t){t||(t=a[Object.keys(a)[0]]);const e=super.create();e.setAttribute("contenteditable","false"),e[r]=t;const i=Math.random().toString(36).slice(2);e.dataset.id=i;const s=document.createElement("div");return s.classList.add("chart"),e.appendChild(s),b(e,i,t,s),e}static value(t){return t[r]||""}get id(){return this.domNode.dataset.id}get text(){return this.domNode[r]}set text(t){this.domNode[r]=t,b(this.domNode,this.id,t,this.getChart())}getChart(){return this.domNode.querySelector(".chart")}}class S{el;options;lastRecorded=0;constructor(t,e){this.options=this.resolveOptions(e),t[d]={redo:[],undo:[]},this.el=t,this.el.addEventListener("beforeinput",(t=>{if(t.isComposing)return;let e=this.el.value,i=[this.el.selectionStart,this.el.selectionEnd];const s=Date.now();if(this.lastRecorded+this.options.delay>s&&this.el[d].undo.length>0){const t=this.el[d].undo.pop();t&&(e=t.value,i=t.range)}else this.lastRecorded=s;this.record(e,i)}));let i={value:"",range:[0,0]};this.el.addEventListener("compositionstart",(()=>{i={value:this.el.value,range:[this.el.selectionStart,this.el.selectionEnd]}})),this.el.addEventListener("compositionend",(()=>{this.record(i.value,i.range)}))}resolveOptions(t={}){return Object.assign({maxStack:100,delay:1e3},t)}record(t,e){this.el[d].redo=[],this.el[d].undo.push({value:t,range:e}),this.el[d].undo.length>this.options.maxStack&&this.el[d].undo.shift()}undo(){const t=this.el[d].undo.pop();t&&(this.el[d].redo.push({value:this.el.value,range:[this.el.selectionStart,this.el.selectionEnd]}),this.el.value=t.value,this.el.setSelectionRange(...t.range))}redo(){const t=this.el[d].redo.pop();t&&(this.el[d].undo.push({value:this.el.value,range:[this.el.selectionStart,this.el.selectionEnd]}),this.el.value=t.value,this.el.setSelectionRange(...t.range))}}class k{quill;mermaidBlot;closeEditor;options;preview;chart;textInput;histroyStackOptions;constructor(t,e,i,s){this.quill=t,this.mermaidBlot=e,this.options=this.resolveOptions(i),this.histroyStackOptions=s;const{dialog:n,close:l}=o({content:this.createEditor(),onClose:this.options.onClose,onShow:()=>this.updatePreview(),clickMaskClose:this.options.dialogMaskClickClose,onConfirm:()=>{this.mermaidBlot.text=this.getInputText()},cancel:!1});this.closeEditor=l,n.style.maxWidth=`${Math.min(1024,.8*window.innerWidth)}px`}resolveOptions(t){return Object.assign({dialogMaskClickClose:!0,onClose:()=>{}},t)}updatePreview(){b(this.preview,"preview",this.getInputText(),this.chart)}getInputText(){return this.textInput.el.value}bindInputEvent(){const t=function(t,e){let i;return function(...s){null!==i&&clearTimeout(i),i=setTimeout((()=>{t.apply(this,s),i=null}),e)}}((()=>{this.updatePreview()}),500);this.textInput.el.addEventListener("keydown",(e=>{let i=!1;if("Tab"===e.code){e.preventDefault();const{selectionStart:t,selectionEnd:s}=this.textInput.el,n=e.target;n.value=`${n.value.slice(0,t)}  ${n.value.slice(s)}`,n.setSelectionRange(t+2,t+2),i=!0}e[c]&&"KeyZ"===e.code&&(e.shiftKey?this.textInput.redo():this.textInput.undo(),e.preventDefault(),i=!0),i&&t()})),this.textInput.el.addEventListener("input",(()=>{t()}))}createEditor(){const t=document.createElement("div");t.classList.add("qmc-mermaid__editor-header");const e=document.createElement("select");e.classList.add("qmc-mermaid__editor-template");const i=document.createElement("option");i.textContent="Template",i.setAttribute("hidden","true"),i.setAttribute("selected","true"),e.appendChild(i),e.setAttribute("placeholder","Template");for(const[t,i]of Object.entries(a)){const s=document.createElement("option");s.value=i,s.textContent=t,e.appendChild(s)}e.addEventListener("change",(t=>{const e=t.target,i=e.value;i&&(this.textInput.record(this.textInput.el.value,[this.textInput.el.selectionStart,this.textInput.el.selectionEnd]),this.textInput.el.value=i,this.updatePreview()),e.selectedIndex=0})),t.appendChild(e);const s=document.createElement("div");s.classList.add("qmc-mermaid__editor");const n=document.createElement("div");return n.classList.add("qmc-mermaid__editor-input"),this.textInput=new S(document.createElement("textarea"),this.histroyStackOptions),this.textInput.el.classList.add("qmc-mermaid__editor-input-content"),this.textInput.el.value=this.mermaidBlot.text,this.bindInputEvent(),n.appendChild(this.textInput.el),this.preview=document.createElement("div"),this.preview.classList.add("qmc-mermaid__editor-preview"),this.chart=document.createElement("div"),this.chart.classList.add("qmc-mermaid__editor-preview-chart"),this.preview.appendChild(this.chart),s.appendChild(n),s.appendChild(this.preview),s.style.height=`${Math.min(600,.7*window.innerHeight)}px`,[t,s]}}class M{quill;mermaidBlot;#t=!1;options;scrollHandler=[];toolbox;selector;resizeOb;editor;histroyStackOptions;constructor(t,e,i,s){this.quill=t,this.mermaidBlot=e,this.options=this.resolveOptions(i),this.histroyStackOptions=s,this.toolbox=this.quill.addContainer("ql-toolbox"),this.createSelector()}resolveOptions(t){return Object.assign({onDestroy:()=>{},editorOptions:{}},t)}addContainer(t){if(!this.toolbox)return;const e=document.createElement("div");for(const i of t.split(" "))e.classList.add(i);return this.toolbox.appendChild(e),e}updateSelector(){if(!this.selector)return;const t=this.mermaidBlot.domNode.getBoundingClientRect(),{x:e,y:i}=function(t,e){const i=e.getBoundingClientRect();return{x:t.x-i.x-e.scrollLeft,y:t.y-i.y-e.scrollTop,x1:t.x-i.x-e.scrollLeft+t.width,y1:t.y-i.y-e.scrollTop+t.height,width:t.width,height:t.height}}(t,this.quill.root),{scrollTop:s,scrollLeft:n}=this.quill.root;Object.assign(this.selector.style,{left:`${e+n}px`,top:`${i+s}px`,width:`${t.width}px`,height:`${t.height}px`}),E.call(this),C.call(this,this.quill.root,(()=>{Object.assign(this.selector.style,{left:e+2*n-this.quill.root.scrollLeft+"px",top:i+2*s-this.quill.root.scrollTop+"px"})}))}createSelector(){if(this.selector=this.addContainer("ql-mermaid-select"),!this.selector)return;this.updateSelector(),this.resizeOb=new ResizeObserver((()=>{this.updateSelector()})),this.resizeOb.observe(this.mermaidBlot.domNode);const t=O({iconStr:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h8.925l-2 2H5v14h14v-6.95l2-2V19q0 .825-.587 1.413T19 21zm4-6v-4.25l9.175-9.175q.3-.3.675-.45t.75-.15q.4 0 .763.15t.662.45L22.425 3q.275.3.425.663T23 4.4t-.137.738t-.438.662L13.25 15zM21.025 4.4l-1.4-1.4zM11 13h1.4l5.8-5.8l-.7-.7l-.725-.7L11 11.575zm6.5-6.5l-.725-.7zl.7.7z"/></svg>',classList:["ql-mermaid-select-edit"],click:()=>{this.editor=new k(this.quill,this.mermaidBlot,{...this.options.editorOptions,onClose:()=>{this.editor=void 0,this.options.editorOptions.onClose&&this.options.editorOptions.onClose()}},this.histroyStackOptions)}}),e=O({iconStr:i,classList:["ql-mermaid-select-close"],click:()=>{this.mermaidBlot.remove(),this.#t=!0,this.destroy()}});this.quill.on(l,(t=>{this.selector&&this.selector.classList.add(t)})),this.selector.appendChild(e),this.selector.appendChild(t)}destroy(){this.quill.off(l),E.call(this),this.resizeOb&&this.resizeOb.disconnect(),this.toolbox&&(this.toolbox.remove(),this.toolbox=void 0),this.#t&&(this.#t=!1,this.options.onDestroy())}}function O(t){const{iconStr:e,classList:i,click:s}=t,n=document.createElement("span");n.classList.add("ql-mermaid-select-btn",...i);const o=document.createElement("i");return o.classList.add("ql-mermaid-icon"),o.innerHTML=e,n.appendChild(o),n.addEventListener("click",s),n}t.QuillMermaid=class{quill;static register(){e.import("ui/icons")[q.blotName]='<svg id="Layer_1" width="1em" height="1em" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 490.16 490.16"><defs><mask id="Mask"><rect x="0" y="0" width="490.16" height="490.16" fill="white"></rect><path fill="black" d="M407.48,111.18A165.2,165.2,0,0,0,245.08,220,165.2,165.2,0,0,0,82.68,111.18a165.5,165.5,0,0,0,72.06,143.64,88.81,88.81,0,0,1,38.53,73.45v50.86H296.9V328.27a88.8,88.8,0,0,1,38.52-73.45,165.41,165.41,0,0,0,72.06-143.64Z"></path><path fill="black" d="M160.63,328.27a56.09,56.09,0,0,0-24.27-46.49,198.74,198.74,0,0,1-28.54-23.66A196.87,196.87,0,0,1,82.53,227V379.13h78.1Z"></path><path fill="black" d="M329.53,328.27a56.09,56.09,0,0,1,24.27-46.49,198.74,198.74,0,0,0,28.54-23.66A196.87,196.87,0,0,0,407.63,227V379.13h-78.1Z"></path></mask><style>.cls-1{fill:#76767B;}.cls-1:hover{fill:#FF3570}</style></defs><rect class="cls-1" width="490.16" height="490.16" rx="84.61" mask="url(#Mask)"></rect></svg>',e.register({[`formats/${q.blotName}`]:q},!0)}mermaidBlot;mermaidSelector;options;constructor(t,i){this.quill=t,this.options=this.resolveOptions(i);const s=this.quill.getModule("toolbar");s&&s.addHandler(q.blotName,(()=>{const t=this.quill.getSelection(!0);this.quill.insertEmbed(t.index,q.blotName,"")})),this.quill.root.addEventListener("click",(t=>{if(!this.quill.scroll.isEnabled())return;const i=t.composedPath();if(!i||i.length<=0)return;const s=i.find((t=>e.find(t)instanceof q));if(s){const t=e.find(s);if(this.mermaidBlot===t)return;this.updateMermaidSelector(t)}else this.destroyMermaidSelector()}),!1)}resolveOptions(t={}){return Object.assign({editor:{},histroyStackOptions:{}},t)}updateMermaidSelector(t){this.mermaidSelector&&this.destroyMermaidSelector(),t&&(this.mermaidBlot=t,this.mermaidSelector=new M(this.quill,this.mermaidBlot,{onDestroy:()=>this.destroyMermaidSelector(),editorOptions:this.options.editor},this.options.histroyStackOptions))}destroyMermaidSelector(){this.mermaidSelector&&(this.mermaidSelector.destroy(),this.mermaidBlot=void 0,this.mermaidSelector=void 0)}}}));
//# sourceMappingURL=dev.js.map
