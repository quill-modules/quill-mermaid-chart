!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).bundle={},e.Quill)}(this,(function(e,t){"use strict";const i=((e,t)=>{const i=`${e}-`;return{b:()=>`${i}${t}`,be:e=>e?`${i}${t}__${e}`:"",bm:e=>e?`${i}${t}--${e}`:"",bem:(e,s)=>e&&s?`${i}${t}__${e}--${s}`:"",ns:e=>e?`${i}${e}`:"",bs:e=>e?`${i}${t}-${e}`:"",cv:e=>e?`--${i}${e}`:"",is:e=>`is-${e}`}})("qmc","mermaid"),s=Symbol("mermaid-data"),o={Flowchart:"flowchart TD\n    A[Start] --\x3e B{Is it?}\n    B --\x3e|Yes| C[OK]\n    C --\x3e D[Rethink]\n    D --\x3e B\n    B ----\x3e|No| E[End]","Sequence Diagrams":"sequenceDiagram\n    Alice->>John: Hello John, how are you?\n    John--\x3e>Alice: Great!\n    Alice-)John: See you later!","Class Diagram":'---\ntitle: Animal example\n---\nclassDiagram\n    note "From Duck till Zebra"\n    Animal <|-- Duck\n    note for Duck "can fly\ncan swim\ncan dive\ncan help in debugging"\n    Animal <|-- Fish\n    Animal <|-- Zebra\n    Animal : +int age\n    Animal : +String gender\n    Animal: +isMammal()\n    Animal: +mate()\n    class Duck{\n        +String beakColor\n        +swim()\n        +quack()\n    }\n    class Fish{\n        -int sizeInFeet\n        -canEat()\n    }\n    class Zebra{\n        +bool is_wild\n        +run()\n    }',"State Diagrem":"---\ntitle: Simple sample\n---\nstateDiagram-v2\n    [*] --\x3e Still\n    Still --\x3e [*]\n\n    Still --\x3e Moving\n    Moving --\x3e Still\n    Moving --\x3e Crash\n    Crash --\x3e [*]","Pie Chart":'pie title Pets adopted by volunteers\n    "Dogs" : 386\n    "Cats" : 85\n    "Rats" : 15',Timeline:"timeline\n    title History of Social Media Platform\n    2002 : LinkedIn\n    2004 : Facebook\n         : Google\n    2005 : Youtube\n    2006 : Twitter"},n=Symbol("histroy-stack"),r=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey";const l="function"==typeof Buffer;"function"==typeof TextDecoder&&new TextDecoder;const a="function"==typeof TextEncoder?new TextEncoder:void 0,d=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");(e=>{let t={};e.forEach(((e,i)=>t[e]=i))})(d);const c=String.fromCharCode.bind(String);"function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array);const h="function"==typeof btoa?e=>btoa(e):l?e=>Buffer.from(e,"binary").toString("base64"):e=>{let t,i,s,o,n="";const r=e.length%3;for(let r=0;r<e.length;){if((i=e.charCodeAt(r++))>255||(s=e.charCodeAt(r++))>255||(o=e.charCodeAt(r++))>255)throw new TypeError("invalid character found");t=i<<16|s<<8|o,n+=d[t>>18&63]+d[t>>12&63]+d[t>>6&63]+d[63&t]}return r?n.slice(0,r-3)+"===".substring(r):n},u=l?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let i=0,s=e.length;i<s;i+=4096)t.push(c.apply(null,e.subarray(i,i+4096)));return h(t.join(""))},m=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?c(192|t>>>6)+c(128|63&t):c(224|t>>>12&15)+c(128|t>>>6&63)+c(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return c(240|t>>>18&7)+c(128|t>>>12&63)+c(128|t>>>6&63)+c(128|63&t)},p=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,g=l?e=>Buffer.from(e,"utf8").toString("base64"):a?e=>u(a.encode(e)):e=>h(e.replace(p,m)),f=(e,t,i)=>{e&&(e=e.cloneNode(!0)),i&&e.setAttribute("height",`${i}px`),t&&e.setAttribute("width",`${t}px`);return((e,t=!1)=>t?(e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")))(g(e)):g(e))(`${e.outerHTML.replaceAll("<br>","<br/>").replaceAll(/<img([^>]*)>/g,((e,t)=>`<img ${t} />`))}`)};function b(e,t,i,s,o){const{close:n}=(e=>{const t=document.createElement("div");t.classList.add("qmc-loading-mask");const i=document.createElement("div");return i.classList.add("qmc-loading-icon"),t.appendChild(i),e.appendChild(t),{close:()=>{t.remove()}}})(e);return new Promise((async r=>{await async function(e,t,i,{config:s}={}){let o=null;try{window.mermaid.initialize(Object.assign({},{startOnLoad:!1,flowchart:{useMaxWidth:!1},sequence:{useMaxWidth:!1},gantt:{useMaxWidth:!1},journey:{useMaxWidth:!1},timeline:{useMaxWidth:!1},class:{useMaxWidth:!1},state:{useMaxWidth:!1},er:{useMaxWidth:!1},pie:{useMaxWidth:!1},quadrantChart:{useMaxWidth:!1},xyChart:{useMaxWidth:!1},requirement:{useMaxWidth:!1},architecture:{useMaxWidth:!1},mindmap:{useMaxWidth:!1},kanban:{useMaxWidth:!1},gitGraph:{useMaxWidth:!1},c4:{useMaxWidth:!1},sankey:{useMaxWidth:!1},packet:{useMaxWidth:!1},block:{useMaxWidth:!1}},s));if(await window.mermaid.parse(t)&&(o=await window.mermaid.render(`chart-${e}`,t,i)),o){const{url:e,width:t,height:s}=(e=>{const t=(new DOMParser).parseFromString(e,"text/html"),i=document.createElement("canvas"),s=t.querySelector("svg");if(!s)throw new Error("svg not found");let o=Number(s.getAttribute("width")),n=Number(s.getAttribute("height"));Number.isNaN(o)&&(o=0),Number.isNaN(n)&&(n=0),i.width=o,i.height=n;const r=i.getContext("2d");if(!r)throw new Error("context not found");return r.fillStyle=`hsl(${window.getComputedStyle(document.body).getPropertyValue("--b1")})`,r.fillRect(0,0,i.width,i.height),{url:`data:image/svg+xml;base64,${f(s,i.width,i.height)}`,width:o,height:n}})(o.svg),n=new Image;n.src=e,t>800&&s>800?Object.assign(i.style,{width:"800px",height:"800px"}):t>s?Object.assign(i.style,{width:`${t}px`,height:null}):Object.assign(i.style,{height:`${s}px`,width:null}),i.appendChild(n)}}catch(e){console.error(e),i.innerHTML=e.message}return o}(t,i,s,o),n(),e.scrollWidth>e.offsetWidth&&(e.scrollLeft=(e.scrollWidth-e.offsetWidth)/2),r()}))}function v(e,t){e.addEventListener("scroll",t),this.scrollHandler.push([e,t])}function x(){for(let e=0;e<this.scrollHandler.length;e++){const[t,i]=this.scrollHandler[e];t.removeEventListener("scroll",i)}this.scrollHandler=[]}class y{el;options;lastRecorded=0;constructor(e,t){this.options=this.resolveOptions(t),e[n]={redo:[],undo:[]},this.el=e,this.el.addEventListener("beforeinput",(e=>{if(e.isComposing)return;let t=this.el.value,i=[this.el.selectionStart,this.el.selectionEnd];const s=Date.now();if(this.lastRecorded+this.options.delay>s&&this.el[n].undo.length>0){const e=this.el[n].undo.pop();e&&(t=e.value,i=e.range)}else this.lastRecorded=s;this.record(t,i)}));let i={value:"",range:[0,0]};this.el.addEventListener("compositionstart",(()=>{i={value:this.el.value,range:[this.el.selectionStart,this.el.selectionEnd]}})),this.el.addEventListener("compositionend",(()=>{this.record(i.value,i.range)}))}resolveOptions(e={}){return Object.assign({maxStack:100,delay:1e3},e)}record(e,t){this.el[n].redo=[],this.el[n].undo.push({value:e,range:t}),this.el[n].undo.length>this.options.maxStack&&this.el[n].undo.shift()}undo(){const e=this.el[n].undo.pop();e&&(this.el[n].redo.push({value:this.el.value,range:[this.el.selectionStart,this.el.selectionEnd]}),this.el.value=e.value,this.el.setSelectionRange(...e.range))}redo(){const e=this.el[n].redo.pop();e&&(this.el[n].undo.push({value:this.el.value,range:[this.el.selectionStart,this.el.selectionEnd]}),this.el.value=e.value,this.el.setSelectionRange(...e.range))}}const w=t.import("blots/block/embed");class S extends w{static tagName="mc-chard";static blotName="mermaid-chart";static className=i.be("chart");static create(e){e||(e=o[Object.keys(o)[0]]);const t=super.create();t.setAttribute("contenteditable","false"),t[s]=e;const n=Math.random().toString(36).slice(2);t.dataset.id=n;const r=document.createElement("div");r.classList.add(i.be("chart-box"));const l=document.createElement("div");return l.classList.add(i.be("chart-inner")),r.appendChild(l),t.appendChild(r),b(r,n,e,l),t}static value(e){return e[s]||""}textInput;mode="chart";get id(){return this.domNode.dataset.id}get text(){return this.domNode[s]}getChart(){return this.domNode.querySelector(`:scope > .${i.be("chart-box")}`)}getChartInner(){return this.domNode.querySelector(`:scope .${i.be("chart-inner")}`)}getEditor(){return this.domNode.querySelector(`:scope > .${i.be("editor")}`)}bindInputEvent(e){const t=function(e,t){let i;return function(...s){null!==i&&clearTimeout(i),i=setTimeout((()=>{e.apply(this,s),i=null}),t)}}((async()=>{await this.updatePreview(e.el.value),e.el.blur(),setTimeout((()=>e.el.focus()))}),500);e.el.addEventListener("keydown",(async i=>{i.stopPropagation();let s=!1;if("Tab"===i.code){i.preventDefault();const{selectionStart:t,selectionEnd:o}=e.el,n=i.target;n.value=`${n.value.slice(0,t)}  ${n.value.slice(o)}`,n.setSelectionRange(t+2,t+2),s=!0}i[r]&&"KeyZ"===i.code&&(i.shiftKey?e.redo():e.undo(),i.preventDefault(),s=!0),s&&t()}),{capture:!0}),e.el.addEventListener("input",(()=>{t()})),e.el.addEventListener("copy",(e=>e.stopPropagation())),e.el.addEventListener("cut",(e=>e.stopPropagation())),e.el.addEventListener("paste",(e=>e.stopPropagation()))}createEditor(){if(this.getEditor())return;const e=document.createElement("div");e.classList.add(i.be("editor")),this.textInput=new y(document.createElement("textarea")),this.textInput.el.classList.add(i.be("editor-input")),this.textInput.el.value=this.domNode[s],this.bindInputEvent(this.textInput),e.appendChild(this.textInput.el),e.addEventListener("click",(()=>{this.textInput&&this.textInput.el.focus()})),this.domNode.insertBefore(e,this.domNode.firstChild),this.mode="edit"}updatePreview(e){const t=this.getChart(),i=this.getChartInner();if(t&&i)return this.domNode[s]=e,b(t,this.id,e,i)}removeEditor(){const e=this.getEditor();e&&(e.remove(),this.mode="chart")}changeMode(e){"edit"===e?"chart"===this.mode&&this.createEditor():"chart"===e&&"edit"===this.mode&&this.removeEditor()}}class E{quill;mermaidBlot;#e=!1;scrollHandler=[];options;root=null;selector;resizeOb;histroyStackOptions;constructor(e,t,s,o){this.quill=e,this.mermaidBlot=t,this.options=this.resolveOptions(s),this.histroyStackOptions=o,this.root=this.quill.addContainer(i.be("toolbox")),this.createSelector()}resolveOptions(e){return Object.assign({onDestroy:()=>{},onRemove:()=>!1,onEdit:()=>{}},e)}addContainer(e){if(!this.root)return;const t=document.createElement("div");for(const i of e.split(" "))t.classList.add(i);return this.root.appendChild(t),t}update(){if(!this.selector)return;const e=this.mermaidBlot.domNode.getBoundingClientRect(),{x:t,y:s}=function(e,t){const i=t.getBoundingClientRect();return{x:e.x-i.x-t.scrollLeft,y:e.y-i.y-t.scrollTop,x1:e.x-i.x-t.scrollLeft+e.width,y1:e.y-i.y-t.scrollTop+e.height,width:e.width,height:e.height}}(e,this.quill.root),{scrollTop:o,scrollLeft:n}=this.quill.root;Object.assign(this.selector.style,{left:`${t+n}px`,top:`${s+o}px`,width:`${e.width}px`,height:`${e.height}px`}),x.call(this),v.call(this,this.quill.root,(()=>{this.selector&&Object.assign(this.selector.style,{left:t+2*n-this.quill.root.scrollLeft+"px",top:s+2*o-this.quill.root.scrollTop+"px"})}));const r=this.selector.querySelector(`.${i.be("select-header")}`);r&&(r.classList.remove(i.is("hidden")),"edit"!==this.mermaidBlot.mode&&r.classList.add(i.is("hidden")));const l=this.selector.querySelector(`.${i.be("select-edit")}`);l&&(l.classList.remove(i.is("edit")),"edit"===this.mermaidBlot.mode&&l.classList.add(i.is("edit")))}createSelector(){if(this.selector=this.addContainer(i.be("select")),!this.selector)return;const e=document.createElement("div");e.classList.add(i.be("select-header")),"edit"!==this.mermaidBlot.mode&&e.classList.add(i.is("hidden"));const t=document.createElement("select");t.classList.add(i.be("select-template"));const s=document.createElement("option");s.textContent="Template",s.setAttribute("hidden","true"),s.setAttribute("selected","true"),t.appendChild(s),t.setAttribute("placeholder","Template");for(const[e,i]of Object.entries(o)){const s=document.createElement("option");s.value=i,s.textContent=e,t.appendChild(s)}t.addEventListener("change",(e=>{const t=e.target,i=t.value;if(i){if(!this.mermaidBlot.textInput)return;this.mermaidBlot.textInput.record(this.mermaidBlot.textInput.el.value,[this.mermaidBlot.textInput.el.selectionStart,this.mermaidBlot.textInput.el.selectionEnd]),this.mermaidBlot.textInput.el.value=i,this.mermaidBlot.updatePreview(i)}t.selectedIndex=0})),e.appendChild(t),this.selector.appendChild(e);const n=M({iconStr:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h8.925l-2 2H5v14h14v-6.95l2-2V19q0 .825-.587 1.413T19 21zm4-6v-4.25l9.175-9.175q.3-.3.675-.45t.75-.15q.4 0 .763.15t.662.45L22.425 3q.275.3.425.663T23 4.4t-.137.738t-.438.662L13.25 15zM21.025 4.4l-1.4-1.4zM11 13h1.4l5.8-5.8l-.7-.7l-.725-.7L11 11.575zm6.5-6.5l-.725-.7zl.7.7z"/></svg>',classList:[i.be("select-edit")],click:()=>{"chart"===this.mermaidBlot.mode?this.mermaidBlot.changeMode("edit"):this.mermaidBlot.changeMode("chart"),this.options.onEdit(this.mermaidBlot,"edit"===this.mermaidBlot.mode),this.update()}}),r=M({iconStr:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>',classList:[i.be("select-close")],click:async()=>{await this.options.onRemove(this.mermaidBlot)||(this.mermaidBlot.remove(),this.#e=!0,this.destroy())}});this.selector.appendChild(r),this.selector.appendChild(n),this.update(),this.resizeOb=new ResizeObserver((()=>{this.update()})),this.resizeOb.observe(this.mermaidBlot.domNode)}destroy(){x.call(this),this.resizeOb&&this.resizeOb.disconnect(),this.root&&this.root.remove(),this.#e&&(this.#e=!1)}}function M(e){const{iconStr:t,classList:s,click:o}=e,n=document.createElement("span");n.classList.add(i.be("select-btn"),...s);const r=document.createElement("i");return r.classList.add(i.be("icon")),r.innerHTML=t,n.appendChild(r),n.addEventListener("click",o),n}e.QuillMermaid=class{quill;static register(){t.import("ui/icons")[S.blotName]='<svg id="Layer_1" width="1em" height="1em" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 490.16 490.16"><defs><mask id="Mask"><rect x="0" y="0" width="490.16" height="490.16" fill="white"></rect><path fill="black" d="M407.48,111.18A165.2,165.2,0,0,0,245.08,220,165.2,165.2,0,0,0,82.68,111.18a165.5,165.5,0,0,0,72.06,143.64,88.81,88.81,0,0,1,38.53,73.45v50.86H296.9V328.27a88.8,88.8,0,0,1,38.52-73.45,165.41,165.41,0,0,0,72.06-143.64Z"></path><path fill="black" d="M160.63,328.27a56.09,56.09,0,0,0-24.27-46.49,198.74,198.74,0,0,1-28.54-23.66A196.87,196.87,0,0,1,82.53,227V379.13h78.1Z"></path><path fill="black" d="M329.53,328.27a56.09,56.09,0,0,1,24.27-46.49,198.74,198.74,0,0,0,28.54-23.66A196.87,196.87,0,0,0,407.63,227V379.13h-78.1Z"></path></mask><style>.cls-1{fill:#76767B;}.cls-1:hover{fill:#FF3570}</style></defs><rect class="cls-1" width="490.16" height="490.16" rx="84.61" mask="url(#Mask)"></rect></svg>',t.register({[`formats/${S.blotName}`]:S},!0)}mermaidBlot;mermaidSelector;options;constructor(e,i){this.quill=e,this.options=this.resolveOptions(i);const s=this.quill.getModule("toolbar");s&&s.addHandler(S.blotName,(()=>{const e=this.quill.getSelection(!0);this.quill.insertEmbed(e.index,S.blotName,"")})),this.quill.root.addEventListener("click",(e=>{if(!this.quill.scroll.isEnabled())return;const i=e.composedPath();if(!i||i.length<=0)return;const s=i.find((e=>t.find(e)instanceof S));if(s){const e=t.find(s);if(this.mermaidBlot===e)return;this.updateMermaidSelector(e)}else this.destroyMermaidSelector()}),!1)}resolveOptions(e={}){return Object.assign({selectorOptions:{},histroyStackOptions:{}},e)}updateMermaidSelector(e){this.mermaidSelector&&this.destroyMermaidSelector(),e&&(this.mermaidBlot=e,this.mermaidSelector=new E(this.quill,this.mermaidBlot,{...this.options.selectorOptions,onDestroy:()=>this.destroyMermaidSelector()},this.options.histroyStackOptions))}destroyMermaidSelector(){this.mermaidSelector&&(this.mermaidSelector.destroy(),this.mermaidBlot=void 0,this.mermaidSelector=void 0)}}}));
//# sourceMappingURL=dev.js.map
